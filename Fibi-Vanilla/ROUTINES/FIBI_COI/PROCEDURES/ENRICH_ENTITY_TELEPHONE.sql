


CREATE PROCEDURE `ENRICH_ENTITY_TELEPHONE`(
    IN AV_ENTITY_ID INT,
    IN AV_TELEPHONE_NUMBER BIGINT,
    IN AV_INT_DIALING_CODE VARCHAR(5),
    IN AV_PERSON_ID VARCHAR(40)
)
BEGIN
    DECLARE telephone_exists INT DEFAULT 0;

    SELECT COUNT(ENTITY_ID) INTO telephone_exists
    FROM ENTITY_TELEPHONE
    WHERE ENTITY_ID = AV_ENTITY_ID 
    AND TELEPHONE_NUMBER = AV_TELEPHONE_NUMBER 
    AND INT_DIALING_CODE = AV_INT_DIALING_CODE;

    IF telephone_exists = 0 THEN
        INSERT INTO ENTITY_TELEPHONE (ENTITY_ID, INT_DIALING_CODE, TELEPHONE_NUMBER, UPDATE_TIMESTAMP, UPDATED_BY) 
		VALUES (AV_ENTITY_ID, AV_INT_DIALING_CODE, AV_TELEPHONE_NUMBER, NOW(), AV_PERSON_ID );
    END IF;
END