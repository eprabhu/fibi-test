CREATE PROCEDURE MIGRATE_AGREEMENT_GENERAL_INFO_TO_AGREEMENT(
	IN AV_SOURCE_MODULE_ID INT,
    IN AV_DESTINATION_MODULE_ID INT,
    IN AV_DESTINATION_MODULE_CODE INT,
    IN AV_SOURCE_MODULE_CODE INT,
    IN AV_UPDATED_USER VARCHAR(60)
)
BEGIN
    DECLARE V_TITLE VARCHAR(1000);
    DECLARE V_START_DATE DATE;
    DECLARE V_END_DATE DATE;
    DECLARE V_UNIT_NUMBER VARCHAR(8);
    DECLARE V_UNIT_NAME VARCHAR(255);

    -- STEP 1: RETRIEVE DATA FROM THE AGREEMENT_HEADER TABLE
    SELECT 
        UNIT_NAME,
        UNIT_NUMBER,
        START_DATE,
        END_DATE,
        TITLE
    INTO 
        V_UNIT_NAME,
        V_UNIT_NUMBER,
        V_START_DATE,
        V_END_DATE,
        V_TITLE
    FROM AGREEMENT_HEADER
    WHERE AGREEMENT_REQUEST_ID = AV_SOURCE_MODULE_ID;

   UPDATE AGREEMENT_HEADER
     SET 
        TITLE = COALESCE(TITLE, V_TITLE),
        START_DATE = COALESCE(START_DATE, V_START_DATE),
        END_DATE = COALESCE(END_DATE, V_END_DATE),
        UNIT_NUMBER = COALESCE(UNIT_NUMBER, V_UNIT_NUMBER),
        UNIT_NAME = COALESCE(UNIT_NAME, V_UNIT_NAME)
    WHERE AGREEMENT_REQUEST_ID = AV_DESTINATION_MODULE_ID;
END
