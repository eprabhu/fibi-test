-- `LOAD_ALL_AWARD_VERSION_CUSTM`; 

CREATE PROCEDURE `LOAD_ALL_AWARD_VERSION_CUSTM`()
BEGIN
DECLARE LS_LAST_SYNC_TIMESTAMP DATETIME;
DECLARE LB_MODULE_ITEM_KEY DECIMAL(12,2);
DECLARE LS_GRANT_CODE LONGTEXT;
DECLARE LS_INPUT_GST_CATEGORY LONGTEXT;
DECLARE LS_OUTPUT_GST_CATEGORY LONGTEXT;
DECLARE LS_STEM_NONSTEM LONGTEXT;
DECLARE LS_RIE_DOMAIN LONGTEXT;
DECLARE LS_SUB_LEAD_UNIT LONGTEXT;
DECLARE LS_PROFIT_CENTER LONGTEXT;
DECLARE LS_FUND_CENTER LONGTEXT;
DECLARE LS_COST_CENTER LONGTEXT;
DECLARE LS_DISPLAY_AT_ACAD_PROFILE LONGTEXT;
DECLARE LS_LEVEL_2_SUP_ORG LONGTEXT;
DECLARE LB_AWARD_ID DECIMAL(22,0);
DECLARE	LS_AWARD_NUMBER VARCHAR(12);
DECLARE	LS_BUDGET_CATEGORY_CODE VARCHAR(3);
DECLARE	LB_ORIGINAL_APPROVED_BUDGET DECIMAL(15,2);
DECLARE LB_LATEST_APPROVED_BUDGET DECIMAL(15,2);
						
	BEGIN 
	DECLARE DONE1 INT DEFAULT FALSE;
	DECLARE CUR_CUSTOM_DATA_REPORT CURSOR FOR
	SELECT
	MODULE_ITEM_KEY,
    MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'GRANT CODE' and IS_LATEST_VERSION = 'Y') then ifnull(description,value)  end) as GRANT_CODE,
    MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'Input GST Category' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as INPUT_GST_CATEGORY,
    MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'Output GST Category' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as OUTPUT_GST_CATEGORY,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'STEM/Non-STEM' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as STEM_NONSTEM,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'RIE Domain' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as RIE_DOMAIN,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'Sub_lead_Unit' and IS_LATEST_VERSION = 'Y') then description end) as SUB_LEAD_UNIT,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'PROFIT CENTER' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as PROFIT_CENTER,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'FUND CENTER' and IS_LATEST_VERSION = 'Y') then ifnull(description,value) end) as FUND_CENTER,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'COST CENTER' and IS_LATEST_VERSION = 'Y' ) then ifnull(description,value) end) as COST_CENTER,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'Display at Acad Profile?' and IS_LATEST_VERSION = 'Y' ) then ifnull(description,value) end) as DISPLAY_AT_ACAD_PROFILE,
	MAX(case when CUSTOM_DATA_ELEMENTS_ID =  (SELECT MAX(CUSTOM_DATA_ELEMENTS_ID) FROM CUSTOM_DATA_ELEMENTS WHERE CUSTOM_ELEMENT_NAME = 'Level_2_Sup_Org' and IS_LATEST_VERSION = 'Y') then description end) as LEVEL_2_SUP_ORG
	FROM CUSTOM_DATA  T1 
	WHERE MODULE_ITEM_CODE = 1
	GROUP BY MODULE_ITEM_KEY;
	
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET DONE1 = TRUE;
   
	OPEN CUR_CUSTOM_DATA_REPORT;
    
    INSERT_LOOP1: LOOP 
		FETCH CUR_CUSTOM_DATA_REPORT INTO 
			LB_MODULE_ITEM_KEY,
			LS_GRANT_CODE,
			LS_INPUT_GST_CATEGORY,
			LS_OUTPUT_GST_CATEGORY,
			LS_STEM_NONSTEM,
			LS_RIE_DOMAIN,
			LS_SUB_LEAD_UNIT,
			LS_PROFIT_CENTER,
			LS_FUND_CENTER,
			LS_COST_CENTER,
			LS_DISPLAY_AT_ACAD_PROFILE,
			LS_LEVEL_2_SUP_ORG;
	IF DONE1  THEN
		LEAVE INSERT_LOOP1;
	END IF;
	
	INSERT INTO LOAD_ALL_AWARD_VERSION_CUSTM(
	MODULE_ITEM_KEY,
	GRANT_CODE,
	INPUT_GST_CATEGORY,
	OUTPUT_GST_CATEGORY,
	STEM_NONSTEM, 
	RIE_DOMAIN,
	SUB_LEAD_UNIT,
	PROFIT_CENTER,
	FUND_CENTER,
	COST_CENTER,
	DISPLAY_AT_ACAD_PROFILE,
	LEVEL_2_SUP_ORG,
	LAST_SYNC_TIME)
	VALUES (
	LB_MODULE_ITEM_KEY,
	LS_GRANT_CODE,
	LS_INPUT_GST_CATEGORY,
	LS_OUTPUT_GST_CATEGORY,
	LS_STEM_NONSTEM,
	LS_RIE_DOMAIN,
	LS_SUB_LEAD_UNIT,
	LS_PROFIT_CENTER,
	LS_FUND_CENTER,
	LS_COST_CENTER,
	LS_DISPLAY_AT_ACAD_PROFILE,
	LS_LEVEL_2_SUP_ORG,
	UTC_TIMESTAMP()
	);
	
	END LOOP;
	CLOSE CUR_CUSTOM_DATA_REPORT;
	END;
commit;
SELECT 1 AS SUCCESS FROM DUAL;
END
