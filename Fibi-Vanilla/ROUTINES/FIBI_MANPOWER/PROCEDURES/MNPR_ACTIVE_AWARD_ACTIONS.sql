CREATE PROCEDURE `MNPR_ACTIVE_AWARD_ACTIONS`(
    AV_CURRENT_AWARD_ID INT,
    AV_AWARD_NUMBER VARCHAR(20),
    AV_ACCOUNT_NUMBER VARCHAR(25),
    AV_DOCUMENT_TYPE VARCHAR(3),
    AV_CURRENT_SEQ_NUMBER INT,
    AV_AWARD_VARIATION_TYPE_CODE VARCHAR(3)
    )
    BEGIN

    DECLARE LI_MANPOWER_STAFF_SECTION_COUNT INT;
    DECLARE LI_ACTIVE_AWARD_ID INT;

    SET LI_MANPOWER_STAFF_SECTION_COUNT = 0;
    SET LI_ACTIVE_AWARD_ID = 0;

    SELECT AWARD_ID INTO LI_ACTIVE_AWARD_ID FROM AWARD WHERE AWARD_NUMBER = AV_AWARD_NUMBER AND SEQUENCE_NUMBER = 0;

    SELECT COUNT(*) INTO LI_MANPOWER_STAFF_SECTION_COUNT from VARIATION_SECTION_MAPPING
    WHERE TYPE_CODE = AV_AWARD_VARIATION_TYPE_CODE AND SECTION_CODE IN (131);

    IF LI_MANPOWER_STAFF_SECTION_COUNT > 0 OR AV_DOCUMENT_TYPE = 1 THEN
        DELETE FROM WORKDAY_RESOURCE_LOG WHERE AWARD_ID = LI_ACTIVE_AWARD_ID;
        
        INSERT INTO WORKDAY_RESOURCE_LOG (AWARD_ID, AWARD_NUMBER, SEQUENCE_NUMBER, WBS_NUMBER, POSITION_STATUS_CODE, COST_ALLOCATION, CHARGE_START_DATE, CHARGE_END_DATE,
        BASE_SALARY_USED, COMMITTED_COST, MULTIPLIER_USED, PERSON_ID, POSITION_ID, ADJUSTED_COMMITTED_COST, JOB_PROFILE_TYPE_CODE,
        WORKDAY_REFERENCE_ID, ACTION_TYPE, UPDATE_USER, UPDATE_TIMESTAMP)
        SELECT LI_ACTIVE_AWARD_ID as AWARD_ID, AV_AWARD_NUMBER as AWARD_NUMBER, 0 as SEQUENCE_NUMBER, WBS_NUMBER, POSITION_STATUS_CODE, COST_ALLOCATION, 
        CHARGE_START_DATE, CHARGE_END_DATE, BASE_SALARY_USED, COMMITTED_COST, MULTIPLIER_USED, PERSON_ID, POSITION_ID, 
        ADJUSTED_COMMITTED_COST, JOB_PROFILE_TYPE_CODE, WORKDAY_REFERENCE_ID, CONCAT('ACTIVE_AWARD-', AV_AWARD_NUMBER) as ACTION_TYPE, UPDATE_USER, NOW() as UPDATE_TIMESTAMP
        FROM MANPOWER_WORKDAY_RESOURCE WHERE SUBSTRING_INDEX(WBS_NUMBER,'EOM',1) = AV_ACCOUNT_NUMBER AND ADJUSTED_COMMITTED_COST IS NOT NULL;
        
    END IF;

    END
    