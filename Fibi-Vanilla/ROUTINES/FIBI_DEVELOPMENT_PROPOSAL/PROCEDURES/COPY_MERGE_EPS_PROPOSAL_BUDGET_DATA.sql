-- `COPY_MERGE_EPS_PROPOSAL_BUDGET_DATA`; 

CREATE PROCEDURE `COPY_MERGE_EPS_PROPOSAL_BUDGET_DATA`(
IN AV_ACTIVE_PROPOSAL_ID  INT,
IN AV_ARCHIVE_PROPOSAL_ID  INT,
IN AV_TYPE VARCHAR(1) 
)
BEGIN
	DECLARE LI_SEQ_PROPOSAL_ID        INT;
	DECLARE LI_BUDGET_HEADER_ID        INT;
	DECLARE LI_BUDGET_PERIOD_ID       INT;
	DECLARE LI_BUDGET_DETAILS_ID      INT;
	DECLARE LI_BUDGET_PERSON_ID       INT;
	DECLARE LI_BUDGET_PERSON_DETAIL_ID  INT;
	DECLARE AV_BUDGET_HEADER_ID INT;
	DECLARE AV_BUDGET_PERIOD_ID INT;
	DECLARE AV_BUDGET_DETAILS_ID INT;
	
    DECLARE LS_ERROR_FLAG      VARCHAR(1);
	DECLARE LS_ERROR_MSG      VARCHAR(2000);
	DECLARE LI_ANTICIPATED_TOTAL	decimal(12,2);
    DECLARE LS_BUDGET_STATUS_CODE	varchar(3);
    DECLARE LS_BUDGET_TYPE_CODE	varchar(3);
    DECLARE LS_COMMENTS	varchar(4000);
    DECLARE LD_CREATE_TIMESTAMP	datetime;
    DECLARE LS_CREATE_USER	varchar(60);
    DECLARE LS_CREATE_USER_NAME	varchar(90);
    DECLARE LD_END_DATE	datetime;
    DECLARE LS_IS_AUTO_CALC	varchar(1);
    DECLARE LI_MODULE_ITEM_CODE	int; 
    DECLARE LI_MODULE_SEQUENCE_NUMBER	int;
    DECLARE LI_OBLIGATED_CHANGE	decimal(12,2);
    DECLARE LI_OBLIGATED_TOTAL	decimal(12,2);
    DECLARE LS_ON_OFF_CAMPUS_FLAG	varchar(1);
    DECLARE LS_RATE_CLASS_CODE	varchar(3);
    DECLARE LS_RATE_TYPE_CODE	varchar(3);
    DECLARE LD_START_DATE	datetime;
    DECLARE LI_TOTAL_COST	decimal(12,2);
    DECLARE LI_TOTAL_DIRECT_COST	decimal(12,2);
    DECLARE LI_TOTAL_INDIRECT_COST	decimal(12,2);
    DECLARE LD_UPDATE_TIMESTAMP	datetime;
    DECLARE LS_UPDATE_USER	varchar(60);
    DECLARE LS_UPDATE_USER_NAME	varchar(90);
    DECLARE LI_VERSION_NUMBER	int;
    DECLARE LI_TOTAL_SUBCONTRACT_COST	decimal(12,2);
    DECLARE LS_IS_FINAL_BUDGET	varchar(1) ;
    DECLARE LI_COST_SHARING_AMOUNT	decimal(12,2);
    DECLARE LS_FINAL_VERSION_FLAG	varchar(255);
    DECLARE LS_MODULAR_BUDGET_FLAG	varchar(255);
    DECLARE LI_RESIDUAL_FUNDS	decimal(12,2);
    DECLARE LS_SUBMIT_COST_SHARING_FLAG	varchar(255); 
    DECLARE LI_UNDERRECOVERY_AMOUNT	decimal(12,2);
    DECLARE LS_UNDERRECOVERY_CLASS_CODE	varchar(255);
    DECLARE LS_UNDERRECOVERY_TYPE_CODE	varchar(255);
    DECLARE LS_IS_LATEST_VERSION	varchar(1);
    DECLARE LS_IS_APPROVED_BUDGET	varchar(255);
    DECLARE LI_BUDGET_TEMPLATE_TYPE_ID	int;
    DECLARE LS_ON_CAMPUS_RATES	varchar(100);
    DECLARE LS_OFF_CAMPUS_RATES	varchar(100);
    DECLARE LI_COST_SHARE_TYPE_CODE	int; 
	DECLARE LS_IS_OBLIGATED_PERIOD	varchar(1); 
	DECLARE LS_MODULE_ITEM_KEY	varchar(30);
	DECLARE LS_PERIOD_LABEL	varchar(255); 
	DECLARE LI_SUBCONTRACT_COST	decimal(12,2); 
	DECLARE LI_TOTAL_COST_LIMIT	decimal(12,2);
	DECLARE LI_TOTAL_DIRECT_COST_LIMIT	decimal(12,2); 
	DECLARE LI_LINE_ITEM_NUMBER	int;  
	DECLARE LS_BUDGET_CATEGORY_CODE	varchar(3);
	DECLARE LS_COST_ELEMENT	varchar(12);
	DECLARE LS_LINE_ITEM_DESCRIPTION	varchar(4000);
	DECLARE LI_LINE_ITEM_COST	decimal(12,2);
	DECLARE LI_PREVIOUS_LINE_ITEM_COST	decimal(12,2);
	DECLARE LS_BUDGET_JUSTIFICATION	varchar(2000);
	DECLARE LS_IS_SYSTEM_GENRTED_COST_ELEMENT	varchar(1); 
	DECLARE LS_SYSTEM_GEN_COST_ELEMENT_TYPE	varchar(60);
	DECLARE LS_FULL_NAME	varchar(90);
	DECLARE LS_PERSON_ID	varchar(40); 
	DECLARE LI_ROLODEX_ID	int;
	DECLARE LS_TBN_ID	varchar(9);
	DECLARE LS_IS_APPLY_INFLATION_RATE	varchar(1); 
	DECLARE LI_COST_SHARING_PERCENT	decimal(5,2);  
	DECLARE LS_APPLY_IN_RATE_FLAG	varchar(255);
	DECLARE LI_QUANTITY	decimal(6,2); 
	DECLARE LI_COST_ELEMENT_BASE	decimal(12,2);
	DECLARE LI_SPONSOR_REQUESTED_AMOUNT	decimal(12,2);
	DECLARE LS_APPLY_RATE_FLAG	varchar(1);
	DECLARE LI_BUDGET_ID	int;
	DECLARE LI_BUDGET_PERIOD	int;
	DECLARE LI_BUDGET_PERIOD_NUMBER	int;
	DECLARE LI_CALCULATED_COST	decimal(12,2);
	DECLARE LI_CALCULATED_COST_SHARING	decimal(12,2); 
	DECLARE LS_RATE_TYPE_DESCRIPTION	varchar(200);  
	DECLARE LI_APPLICABLE_RATE	decimal(12,2);
	DECLARE LI_CALCULATED_FUND_REQUESTED	decimal(12,2);
	DECLARE LI_APPLICABLE_COST_SHARING_RATE	decimal(10,2);	
	DECLARE LI_BASE_COST	decimal(12,2);  
	DECLARE LI_APPLIED_RATE	decimal(5,2);
	DECLARE LI_BASE_COST_SHARING	decimal(14,2);  
	DECLARE LI_RATE_NUMBER	int; 
	DECLARE LS_APPOINTMENT_TYPE_CODE	varchar(255); 
	DECLARE LI_CALCULATION_BASE	decimal(12,2);
	DECLARE LD_EFFECTIVE_DATE	datetime(6);
	DECLARE LS_JOB_CODE	varchar(255);
	DECLARE LS_NON_EMPLOYEE_FLAG	varchar(255); 
	DECLARE LS_PERSON_NAME	varchar(255); 
	DECLARE LD_SALARY_ANNIVERSARY_DATE	datetime(6);  
	DECLARE LS_PERSON_TYPE	varchar(255); 
	DECLARE LI_PERCENT_CHARGED	decimal(5,2);
	DECLARE LI_PERCENT_EFFORT	decimal(5,2); 
	DECLARE LI_SALARY_REQUESTED	decimal(12,2);
	DECLARE LI_TOTAL_SALARY	decimal(12,2);
	DECLARE LI_NO_OF_MONTHS	decimal(4,2);  
	DECLARE LI_SALARY	decimal(12,2);  
	DECLARE LI_CONSORTIUM_FNA	decimal(12,2);
	DECLARE LI_DIRECT_COST_LESS_CONSOR_FNA	decimal(12,2);  
	DECLARE LI_DESCRIPTION	int;
	DECLARE LI_FUNDS_REQUESTED	decimal(12,2);
	DECLARE LI_IDC_BASE	decimal(12,2);
	DECLARE LI_IDC_RATE	decimal(5,2);  
	DECLARE LS_ACTIVITY_TYPE_CODE	varchar(3); 
	DECLARE LS_FISCAL_YEAR	varchar(4);
	DECLARE LI_INSTITUTE_RATE	decimal(12,2); 
	DECLARE LI_LS_BUDGET_PERSON_ID INT;
	
    DECLARE LS_PROC_LOC         VARCHAR(300);
    DECLARE NOT_FOUND	INT DEFAULT 0;
    
	
	DECLARE  SEL_BUDGET_HEADER CURSOR FOR
	SELECT BUDGET_HEADER_ID, ANTICIPATED_TOTAL, BUDGET_STATUS_CODE, BUDGET_TYPE_CODE, COMMENTS, CREATE_TIMESTAMP, 
	CREATE_USER, CREATE_USER_NAME, END_DATE, IS_AUTO_CALC, MODULE_ITEM_CODE, MODULE_ITEM_KEY, MODULE_SEQUENCE_NUMBER, OBLIGATED_CHANGE, OBLIGATED_TOTAL, ON_OFF_CAMPUS_FLAG, RATE_CLASS_CODE, RATE_TYPE_CODE, START_DATE, TOTAL_COST, TOTAL_DIRECT_COST, TOTAL_INDIRECT_COST, UPDATE_TIMESTAMP, UPDATE_USER, UPDATE_USER_NAME, VERSION_NUMBER, TOTAL_SUBCONTRACT_COST, IS_FINAL_BUDGET,COST_SHARING_AMOUNT, FINAL_VERSION_FLAG, MODULAR_BUDGET_FLAG, RESIDUAL_FUNDS, SUBMIT_COST_SHARING_FLAG, TOTAL_COST_LIMIT, UNDERRECOVERY_AMOUNT, UNDERRECOVERY_CLASS_CODE, UNDERRECOVERY_TYPE_CODE, IS_LATEST_VERSION, IS_APPROVED_BUDGET,BUDGET_TEMPLATE_TYPE_ID, ON_CAMPUS_RATES, OFF_CAMPUS_RATES, COST_SHARE_TYPE_CODE 
    FROM BUDGET_HEADER WHERE PROPOSAL_ID = li_seq_proposal_id;
	
	DECLARE  SEL_BUDGET_PERIOD CURSOR FOR
	SELECT BUDGET_PERIOD_ID,BUDGET_PERIOD, END_DATE, IS_OBLIGATED_PERIOD, MODULE_ITEM_CODE, MODULE_ITEM_KEY, PERIOD_LABEL, START_DATE,
    TOTAL_COST, TOTAL_DIRECT_COST, TOTAL_INDIRECT_COST, UPDATE_TIMESTAMP, UPDATE_USER, VERSION_NUMBER, SUBCONTRACT_COST, 
    COMMENTS, COST_SHARING_AMOUNT, TOTAL_COST_LIMIT, TOTAL_DIRECT_COST_LIMIT, UNDERRECOVERY_AMOUNT
    FROM BUDGET_PERIOD WHERE BUDGET_HEADER_ID IN (AV_BUDGET_HEADER_ID);
	
	
	DECLARE  SEL_BUDGET_DETAIL CURSOR FOR
	SELECT  BUDGET_DETAILS_ID,VERSION_NUMBER, BUDGET_PERIOD, LINE_ITEM_NUMBER, 
	START_DATE, END_DATE, BUDGET_CATEGORY_CODE, COST_ELEMENT, LINE_ITEM_DESCRIPTION, LINE_ITEM_COST, PREVIOUS_LINE_ITEM_COST, 
	BUDGET_JUSTIFICATION, IS_SYSTEM_GENRTED_COST_ELEMENT, ON_OFF_CAMPUS_FLAG, SYSTEM_GEN_COST_ELEMENT_TYPE, FULL_NAME, PERSON_ID, 
	PERSON_TYPE, ROLODEX_ID, TBN_ID, IS_APPLY_INFLATION_RATE, COST_SHARING_AMOUNT, COST_SHARING_PERCENT, UPDATE_TIMESTAMP, UPDATE_USER,
	APPLY_IN_RATE_FLAG, QUANTITY, SUBMIT_COST_SHARING_FLAG, UNDERRECOVERY_AMOUNT, COST_ELEMENT_BASE, SPONSOR_REQUESTED_AMOUNT
	FROM BUDGET_DETAIL WHERE  BUDGET_PERIOD_ID IN (AV_BUDGET_PERIOD_ID);
 
    DECLARE  SEL_BUDGET_DET_CAL_AMT CURSOR FOR
	SELECT APPLY_RATE_FLAG, BUDGET_ID, BUDGET_PERIOD, BUDGET_PERIOD_NUMBER, CALCULATED_COST,
	CALCULATED_COST_SHARING, LINE_ITEM_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE, RATE_TYPE_DESCRIPTION, UPDATE_TIMESTAMP, 
	UPDATE_USER, APPLICABLE_RATE, CALCULATED_FUND_REQUESTED, APPLICABLE_COST_SHARING_RATE FROM BUDGET_DET_CAL_AMT WHERE BUDGET_DETAILS_ID IN (AV_BUDGET_DETAILS_ID) ;
	
	DECLARE  SEL_BUDGET_RATE_AND_BASE CURSOR FOR
	SELECT  BASE_COST, BUDGET_ID, BUDGET_PERIOD, BUDGET_PERIOD_NUMBER, LINE_ITEM_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE, UPDATE_TIMESTAMP,UPDATE_USER,   APPLIED_RATE, BASE_COST_SHARING,CALCULATED_COST, CALCULATED_COST_SHARING, END_DATE, ON_OFF_CAMPUS_FLAG, RATE_NUMBER, START_DATE
    FROM BUDGET_RATE_AND_BASE  WHERE BUDGET_DETAILS_ID IN (AV_BUDGET_DETAILS_ID);
	
	DECLARE  SEL_BUDGET_PERSONS CURSOR FOR
	SELECT BUDGET_PERSON_ID,APPOINTMENT_TYPE_CODE,CALCULATION_BASE, EFFECTIVE_DATE, JOB_CODE, 
    NON_EMPLOYEE_FLAG, PERSON_ID, PERSON_NAME, ROLODEX_ID, SALARY_ANNIVERSARY_DATE, TBN_ID, UPDATE_TIMESTAMP, UPDATE_USER,
     PERSON_TYPE FROM BUDGET_PERSONS WHERE BUDGET_HEADER_ID IN (AV_BUDGET_HEADER_ID);
	
    DECLARE  SEL_BUDGET_PERSON_DETAIL CURSOR FOR
	SELECT PERSON_NAME, PERSON_TYPE, PERSON_ID, ROLODEX_ID, TBN_ID,
    UNDERRECOVERY_AMOUNT, PERCENT_CHARGED, PERCENT_EFFORT, COST_SHARING_AMOUNT, COST_SHARING_PERCENT, SALARY_REQUESTED,
    TOTAL_SALARY, NO_OF_MONTHS, UPDATE_TIMESTAMP, UPDATE_USER, END_DATE, START_DATE,
    SPONSOR_REQUESTED_AMOUNT, SALARY FROM BUDGET_PERSON_DETAIL WHERE BUDGET_PERSON_ID IN (LI_LS_BUDGET_PERSON_ID); 
	
    DECLARE  SEL_BUDGET_PERSON_DET_CAL_AMT CURSOR FOR
	SELECT BUDGET_ID, BUDGET_PERIOD, BUDGET_PERIOD_NUMBER, 
	APPLY_RATE_FLAG, CALCULATED_COST, CALCULATED_COST_SHARING, LINE_ITEM_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE, 
	RATE_TYPE_DESCRIPTION, APPLICABLE_RATE, UPDATE_TIMESTAMP, UPDATE_USER FROM BUDGET_PERSON_DET_CAL_AMT WHERE 	BUDGET_PERSON_DETAIL_ID IN (SELECT
	BUDGET_PERSON_DETAIL_ID FROM BUDGET_PERSON_DETAIL WHERE BUDGET_PERSON_ID IN (LI_LS_BUDGET_PERSON_ID) );
	
	DECLARE  SEL_BUDGET_MODULAR CURSOR FOR
	SELECT CONSORTIUM_FNA, DIRECT_COST_LESS_CONSOR_FNA, TOTAL_DIRECT_COST,
    UPDATE_TIMESTAMP, UPDATE_USER FROM BUDGET_MODULAR WHERE BUDGET_HEADER_ID IN (AV_BUDGET_HEADER_ID);
	
	DECLARE  SEL_BUDGET_MODULAR_IDC CURSOR FOR
	SELECT  DESCRIPTION, FUNDS_REQUESTED, IDC_BASE, IDC_RATE, UPDATE_TIMESTAMP, UPDATE_USER 
    FROM BUDGET_MODULAR_IDC WHERE BUDGET_PERIOD_ID IN (AV_BUDGET_PERIOD_ID);
	
	DECLARE  SEL_EPS_PROPOSAL_RATES CURSOR FOR
	SELECT   ACTIVITY_TYPE_CODE, APPLICABLE_RATE, FISCAL_YEAR, INSTITUTE_RATE, ON_OFF_CAMPUS_FLAG, RATE_CLASS_CODE,
    RATE_TYPE_CODE, START_DATE, UPDATE_TIMESTAMP, UPDATE_USER  FROM EPS_PROPOSAL_RATES WHERE BUDGET_HEADER_ID IN (AV_BUDGET_HEADER_ID);
	
	
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
				BEGIN
				
					GET DIAGNOSTICS CONDITION 1 @sqlstate = RETURNED_SQLSTATE, 
					 @errno = MYSQL_ERRNO, @msg = MESSAGE_TEXT;					 
					SET @full_error = CONCAT(@msg,'/',LS_PROC_LOC);	
                    SET  LS_ERROR_FLAG = 'Y';
                    SET LS_ERROR_MSG = 	@full_error;		
 		          RESIGNAL SET MESSAGE_TEXT = LS_ERROR_MSG;
                END;
				
     DECLARE CONTINUE HANDLER FOR NOT FOUND SET NOT_FOUND = 1;
  SET  LS_ERROR_FLAG = 'N';
  
  
  	 IF AV_TYPE = 'M' THEN 
	SET SQL_SAFE_UPDATES = 0;
    
      SET LS_PROC_LOC = 'DELETE_BUDGET';
DELETE FROM EPS_PROPOSAL_RATES WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID);
DELETE FROM BUDGET_MODULAR WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID);
DELETE FROM BUDGET_PERSON_DET_CAL_AMT WHERE  BUDGET_PERSON_DETAIL_ID IN (SELECT
	BUDGET_PERSON_DETAIL_ID FROM BUDGET_PERSON_DETAIL WHERE BUDGET_PERSON_ID IN ((SELECT BUDGET_PERSON_ID FROM BUDGET_PERSONS WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID) )) );
	
	
DELETE FROM BUDGET_PERSON_DETAIL WHERE BUDGET_PERSON_ID IN (SELECT BUDGET_PERSON_ID FROM BUDGET_PERSONS WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID) );
DELETE FROM BUDGET_PERSONS WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID);
DELETE FROM  BUDGET_RATE_AND_BASE WHERE BUDGET_DETAILS_ID IN (SELECT BUDGET_DETAILS_ID FROM BUDGET_DETAIL WHERE  BUDGET_PERIOD_ID IN (SELECT BUDGET_PERIOD_ID FROM BUDGET_PERIOD WHERE BUDGET_HEADER_ID IN 
(SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID)));
DELETE FROM BUDGET_DET_CAL_AMT WHERE BUDGET_DETAILS_ID IN (SELECT BUDGET_DETAILS_ID FROM BUDGET_DETAIL WHERE  BUDGET_PERIOD_ID IN (SELECT BUDGET_PERIOD_ID FROM BUDGET_PERIOD WHERE BUDGET_HEADER_ID IN 
(SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID)));
DELETE FROM BUDGET_DETAIL WHERE  BUDGET_PERIOD_ID IN (SELECT BUDGET_PERIOD_ID FROM BUDGET_PERIOD WHERE BUDGET_HEADER_ID IN 
(SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID));
DELETE FROM BUDGET_PERIOD WHERE BUDGET_HEADER_ID IN (SELECT BUDGET_HEADER_ID FROM BUDGET_HEADER WHERE PROPOSAL_ID =AV_ACTIVE_PROPOSAL_ID);
DELETE FROM BUDGET_HEADER WHERE PROPOSAL_ID = AV_ACTIVE_PROPOSAL_ID;
SET SQL_SAFE_UPDATES = 1;
	
     SET li_seq_proposal_id = AV_ARCHIVE_PROPOSAL_ID;
	 SET SQL_SAFE_UPDATES =1;
	 
	 ELSEIF AV_TYPE = 'C' THEN 
	 
	 SET li_seq_proposal_id = AV_ACTIVE_PROPOSAL_ID;
	
	 END IF;
   
 
  
   SET LS_PROC_LOC = 'BUDGET_HEADER';
			
       OPEN SEL_BUDGET_HEADER;
            SEL_BUDGET_HEADER:LOOP
            
			 SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_HEADER INTO  AV_BUDGET_HEADER_ID,LI_ANTICIPATED_TOTAL,LS_BUDGET_STATUS_CODE,LS_BUDGET_TYPE_CODE ,LS_COMMENTS ,LD_CREATE_TIMESTAMP ,LS_CREATE_USER,LS_CREATE_USER_NAME ,LD_END_DATE ,LS_IS_AUTO_CALC ,LI_MODULE_ITEM_CODE ,LS_MODULE_ITEM_KEY  ,LI_MODULE_SEQUENCE_NUMBER,LI_OBLIGATED_CHANGE ,LI_OBLIGATED_TOTAL ,	LS_ON_OFF_CAMPUS_FLAG,LS_RATE_CLASS_CODE  ,LS_RATE_TYPE_CODE,LD_START_DATE,LI_TOTAL_COST,LI_TOTAL_DIRECT_COST,LI_TOTAL_INDIRECT_COST,LD_UPDATE_TIMESTAMP ,LS_UPDATE_USER,LS_UPDATE_USER_NAME ,LI_VERSION_NUMBER,LI_TOTAL_SUBCONTRACT_COST,LS_IS_FINAL_BUDGET  ,LI_COST_SHARING_AMOUNT,LS_FINAL_VERSION_FLAG,LS_MODULAR_BUDGET_FLAG,LI_RESIDUAL_FUNDS,LS_SUBMIT_COST_SHARING_FLAG ,LI_TOTAL_COST_LIMIT ,LI_UNDERRECOVERY_AMOUNT  ,LS_UNDERRECOVERY_CLASS_CODE ,LS_UNDERRECOVERY_TYPE_CODE  ,LS_IS_LATEST_VERSION,LS_IS_APPROVED_BUDGET,LI_BUDGET_TEMPLATE_TYPE_ID  ,	LS_ON_CAMPUS_RATES  ,LS_OFF_CAMPUS_RATES ,LI_COST_SHARE_TYPE_CODE ; 
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_HEADER;
            END IF;
 
                INSERT INTO BUDGET_HEADER	
                (
				    ANTICIPATED_TOTAL,
					BUDGET_STATUS_CODE,
					BUDGET_TYPE_CODE,
					COMMENTS,
					CREATE_TIMESTAMP,
					CREATE_USER,
					CREATE_USER_NAME,
					END_DATE,
					IS_AUTO_CALC,
					MODULE_ITEM_CODE,
					MODULE_ITEM_KEY,
					MODULE_SEQUENCE_NUMBER,
					OBLIGATED_CHANGE,
					OBLIGATED_TOTAL,
					ON_OFF_CAMPUS_FLAG,
					RATE_CLASS_CODE,
					RATE_TYPE_CODE,
					START_DATE,
					TOTAL_COST,
					TOTAL_DIRECT_COST,
					TOTAL_INDIRECT_COST,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					UPDATE_USER_NAME,
					VERSION_NUMBER,
					TOTAL_SUBCONTRACT_COST,
					IS_FINAL_BUDGET,
					PROPOSAL_ID,
					COST_SHARING_AMOUNT,
					FINAL_VERSION_FLAG,
					MODULAR_BUDGET_FLAG,
					RESIDUAL_FUNDS,
					SUBMIT_COST_SHARING_FLAG,
					TOTAL_COST_LIMIT,
					UNDERRECOVERY_AMOUNT,
					UNDERRECOVERY_CLASS_CODE,
					UNDERRECOVERY_TYPE_CODE,
					IS_LATEST_VERSION,
					IS_APPROVED_BUDGET,
					BUDGET_TEMPLATE_TYPE_ID,
					ON_CAMPUS_RATES,
					OFF_CAMPUS_RATES,
					COST_SHARE_TYPE_CODE  )
                 VALUES(
				 
				    LI_ANTICIPATED_TOTAL,
					LS_BUDGET_STATUS_CODE,
					LS_BUDGET_TYPE_CODE,
					LS_COMMENTS,
					LD_CREATE_TIMESTAMP,
					LS_CREATE_USER,
					LS_CREATE_USER_NAME,
					LD_END_DATE,
					LS_IS_AUTO_CALC,
					LI_MODULE_ITEM_CODE,
					LS_MODULE_ITEM_KEY,
					LI_MODULE_SEQUENCE_NUMBER,
					LI_OBLIGATED_CHANGE,
					LI_OBLIGATED_TOTAL,
					LS_ON_OFF_CAMPUS_FLAG,
					LS_RATE_CLASS_CODE,
					LS_RATE_TYPE_CODE,
					LD_START_DATE,
					LI_TOTAL_COST,
					LI_TOTAL_DIRECT_COST,
					LI_TOTAL_INDIRECT_COST,
					LD_UPDATE_TIMESTAMP,
					LS_UPDATE_USER,
					LS_UPDATE_USER_NAME,
					LI_VERSION_NUMBER,
					LI_TOTAL_SUBCONTRACT_COST,
					LS_IS_FINAL_BUDGET,
					CASE WHEN AV_TYPE = 'M' THEN AV_ACTIVE_PROPOSAL_ID WHEN AV_TYPE = 'C' THEN AV_ARCHIVE_PROPOSAL_ID END,
					LI_COST_SHARING_AMOUNT,
					LS_FINAL_VERSION_FLAG,
					LS_MODULAR_BUDGET_FLAG,
					LI_RESIDUAL_FUNDS,
					LS_SUBMIT_COST_SHARING_FLAG,
					LI_TOTAL_COST_LIMIT,
					LI_UNDERRECOVERY_AMOUNT,
					LS_UNDERRECOVERY_CLASS_CODE,
					LS_UNDERRECOVERY_TYPE_CODE,
					LS_IS_LATEST_VERSION,
					LS_IS_APPROVED_BUDGET,
					LI_BUDGET_TEMPLATE_TYPE_ID,
					LS_ON_CAMPUS_RATES,
					LS_OFF_CAMPUS_RATES,
					LI_COST_SHARE_TYPE_CODE	 
                
                );
                
            SET LI_BUDGET_HEADER_ID = LAST_INSERT_ID();
			
  
  SET LS_PROC_LOC = 'BUDGET_PERIOD';
			
            OPEN SEL_BUDGET_PERIOD;
            SEL_BUDGET_PERIOD:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_PERIOD INTO AV_BUDGET_PERIOD_ID,LI_BUDGET_PERIOD,LD_END_DATE,LS_IS_OBLIGATED_PERIOD,LI_MODULE_ITEM_CODE,LS_MODULE_ITEM_KEY,LS_PERIOD_LABEL,LD_START_DATE,LI_TOTAL_COST,LI_TOTAL_DIRECT_COST,LI_TOTAL_INDIRECT_COST,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER,LI_VERSION_NUMBER,
			LI_SUBCONTRACT_COST,LS_COMMENTS,LI_COST_SHARING_AMOUNT,LI_TOTAL_COST_LIMIT,LI_TOTAL_DIRECT_COST_LIMIT,LI_UNDERRECOVERY_AMOUNT; 
			 
            IF NOT_FOUND = 1 THEN
            LEAVE SEL_BUDGET_PERIOD;
            END IF;
                        
                 INSERT INTO BUDGET_PERIOD	
                (
					BUDGET_PERIOD,
					END_DATE,
					IS_OBLIGATED_PERIOD,
					MODULE_ITEM_CODE,
					MODULE_ITEM_KEY,
					PERIOD_LABEL,
					START_DATE,
					TOTAL_COST,
					TOTAL_DIRECT_COST,
					TOTAL_INDIRECT_COST,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					VERSION_NUMBER,
					BUDGET_HEADER_ID,
					SUBCONTRACT_COST,
					COMMENTS,
					COST_SHARING_AMOUNT,
					TOTAL_COST_LIMIT,
					TOTAL_DIRECT_COST_LIMIT,
					UNDERRECOVERY_AMOUNT  )
                 VALUES(
				 
				   LI_BUDGET_PERIOD,
				   LD_END_DATE,
				   LS_IS_OBLIGATED_PERIOD,
				   LI_MODULE_ITEM_CODE,
				   LS_MODULE_ITEM_KEY,
				   LS_PERIOD_LABEL,
				   LD_START_DATE,
				   LI_TOTAL_COST,
				   LI_TOTAL_DIRECT_COST,
				   LI_TOTAL_INDIRECT_COST,
				   LD_UPDATE_TIMESTAMP,
				   LS_UPDATE_USER,
				   LI_VERSION_NUMBER,
				   LI_BUDGET_HEADER_ID,
				   LI_SUBCONTRACT_COST,
				   LS_COMMENTS,
				   LI_COST_SHARING_AMOUNT,
				   LI_TOTAL_COST_LIMIT,
				   LI_TOTAL_DIRECT_COST_LIMIT,
				   LI_UNDERRECOVERY_AMOUNT                
                );
              
              SET LI_BUDGET_PERIOD_ID = LAST_INSERT_ID();
  	
  SET LS_PROC_LOC = 'BUDGET_DETAIL';
			
            OPEN SEL_BUDGET_DETAIL;
            SEL_BUDGET_DETAIL:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_DETAIL INTO AV_BUDGET_DETAILS_ID,LI_VERSION_NUMBER,LI_BUDGET_PERIOD,LI_LINE_ITEM_NUMBER,LD_START_DATE,LD_END_DATE,LS_BUDGET_CATEGORY_CODE,LS_COST_ELEMENT,LS_LINE_ITEM_DESCRIPTION,LI_LINE_ITEM_COST,LI_PREVIOUS_LINE_ITEM_COST,LS_BUDGET_JUSTIFICATION,LS_IS_SYSTEM_GENRTED_COST_ELEMENT,LS_ON_OFF_CAMPUS_FLAG,LS_SYSTEM_GEN_COST_ELEMENT_TYPE,LS_FULL_NAME,LS_PERSON_ID,LS_PERSON_TYPE,LI_ROLODEX_ID,LS_TBN_ID,LS_IS_APPLY_INFLATION_RATE,LI_COST_SHARING_AMOUNT,LI_COST_SHARING_PERCENT,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER,LS_APPLY_IN_RATE_FLAG,LI_QUANTITY,LS_SUBMIT_COST_SHARING_FLAG,LI_UNDERRECOVERY_AMOUNT,LI_COST_ELEMENT_BASE,LI_SPONSOR_REQUESTED_AMOUNT ; 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_DETAIL;
            END IF;
            
               
                INSERT INTO BUDGET_DETAIL	
                (
					BUDGET_HEADER_ID,
					BUDGET_PERIOD_ID,
					VERSION_NUMBER,
					BUDGET_PERIOD,
					LINE_ITEM_NUMBER,
					START_DATE,
					END_DATE,
					BUDGET_CATEGORY_CODE,
					COST_ELEMENT,
					LINE_ITEM_DESCRIPTION,
					LINE_ITEM_COST,
					PREVIOUS_LINE_ITEM_COST,
					BUDGET_JUSTIFICATION,
					IS_SYSTEM_GENRTED_COST_ELEMENT,
					ON_OFF_CAMPUS_FLAG,
					SYSTEM_GEN_COST_ELEMENT_TYPE,
					FULL_NAME,
					PERSON_ID,
					PERSON_TYPE,
					ROLODEX_ID,
					TBN_ID,
					IS_APPLY_INFLATION_RATE,
					COST_SHARING_AMOUNT,
					COST_SHARING_PERCENT,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					APPLY_IN_RATE_FLAG,
					QUANTITY,
					SUBMIT_COST_SHARING_FLAG,
					UNDERRECOVERY_AMOUNT,
					COST_ELEMENT_BASE,
					SPONSOR_REQUESTED_AMOUNT )
                 VALUES(
				   LI_BUDGET_HEADER_ID,
				   LI_BUDGET_PERIOD_ID,
				   LI_VERSION_NUMBER,
				   LI_BUDGET_PERIOD,
				   LI_LINE_ITEM_NUMBER,
				   LD_START_DATE,
				   LD_END_DATE,
				   LS_BUDGET_CATEGORY_CODE,
				   LS_COST_ELEMENT,
				   LS_LINE_ITEM_DESCRIPTION,
				   LI_LINE_ITEM_COST,
				   LI_PREVIOUS_LINE_ITEM_COST,
				   LS_BUDGET_JUSTIFICATION,
				   LS_IS_SYSTEM_GENRTED_COST_ELEMENT,
				   LS_ON_OFF_CAMPUS_FLAG,
				   LS_SYSTEM_GEN_COST_ELEMENT_TYPE,
				   LS_FULL_NAME,
				   LS_PERSON_ID,
				   LS_PERSON_TYPE,
				   LI_ROLODEX_ID,
				   LS_TBN_ID,
				   LS_IS_APPLY_INFLATION_RATE,
				   LI_COST_SHARING_AMOUNT,
				   LI_COST_SHARING_PERCENT,
				   LD_UPDATE_TIMESTAMP,
				   LS_UPDATE_USER,
				   LS_APPLY_IN_RATE_FLAG,
				   LI_QUANTITY,
				   LS_SUBMIT_COST_SHARING_FLAG,
				   LI_UNDERRECOVERY_AMOUNT,
				   LI_COST_ELEMENT_BASE,
				   LI_SPONSOR_REQUESTED_AMOUNT             
                );
                
            SET LI_BUDGET_DETAILS_ID  = LAST_INSERT_ID(); 
        
  SET LS_PROC_LOC = 'BUDGET_DET_CAL_AMT';
			
            OPEN SEL_BUDGET_DET_CAL_AMT;
            SEL_BUDGET_DET_CAL_AMT:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_DET_CAL_AMT INTO LS_APPLY_RATE_FLAG,LI_BUDGET_ID,LI_BUDGET_PERIOD,LI_BUDGET_PERIOD_NUMBER,LI_CALCULATED_COST,LI_CALCULATED_COST_SHARING,LI_LINE_ITEM_NUMBER,LS_RATE_CLASS_CODE,LS_RATE_TYPE_CODE,LS_RATE_TYPE_DESCRIPTION,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER,
            LI_APPLICABLE_RATE,LI_CALCULATED_FUND_REQUESTED,LI_APPLICABLE_COST_SHARING_RATE;
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_DET_CAL_AMT;
            END IF;
            
               
                INSERT INTO BUDGET_DET_CAL_AMT	
                (
					APPLY_RATE_FLAG,
					BUDGET_ID,
					BUDGET_PERIOD,
					BUDGET_PERIOD_NUMBER,
					CALCULATED_COST,
					CALCULATED_COST_SHARING,
					LINE_ITEM_NUMBER,
					RATE_CLASS_CODE,
					RATE_TYPE_CODE,
					RATE_TYPE_DESCRIPTION,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					BUDGET_DETAILS_ID,
					APPLICABLE_RATE,
					CALCULATED_FUND_REQUESTED,
					APPLICABLE_COST_SHARING_RATE )
                 VALUES(
				  LS_APPLY_RATE_FLAG,
				  LI_BUDGET_ID,
				  LI_BUDGET_PERIOD,
				  LI_BUDGET_PERIOD_NUMBER,
				  LI_CALCULATED_COST,
				  LI_CALCULATED_COST_SHARING,
				  LI_LINE_ITEM_NUMBER,
				  LS_RATE_CLASS_CODE,
				  LS_RATE_TYPE_CODE,
				  LS_RATE_TYPE_DESCRIPTION,
				  LD_UPDATE_TIMESTAMP,
				  LS_UPDATE_USER,
				  LI_BUDGET_DETAILS_ID,
				  LI_APPLICABLE_RATE,
				  LI_CALCULATED_FUND_REQUESTED,
				  LI_APPLICABLE_COST_SHARING_RATE            
                );
                
              
		END LOOP SEL_BUDGET_DET_CAL_AMT;
		CLOSE SEL_BUDGET_DET_CAL_AMT;
 SET LS_PROC_LOC = 'BUDGET_RATE_AND_BASE';
			
            OPEN SEL_BUDGET_RATE_AND_BASE;
            SEL_BUDGET_RATE_AND_BASE:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_RATE_AND_BASE INTO LI_BASE_COST,LI_BUDGET_ID,LI_BUDGET_PERIOD,LI_BUDGET_PERIOD_NUMBER,LI_LINE_ITEM_NUMBER,LS_RATE_CLASS_CODE,LS_RATE_TYPE_CODE,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER,LI_APPLIED_RATE,LI_BASE_COST_SHARING,LI_CALCULATED_COST,LI_CALCULATED_COST_SHARING,LD_END_DATE,LS_ON_OFF_CAMPUS_FLAG,LI_RATE_NUMBER,LD_START_DATE;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_RATE_AND_BASE;
            END IF;
            
               
                INSERT INTO BUDGET_RATE_AND_BASE	
                (
					BASE_COST,
					BUDGET_ID,
					BUDGET_PERIOD,
					BUDGET_PERIOD_NUMBER,
					LINE_ITEM_NUMBER,
					RATE_CLASS_CODE,
					RATE_TYPE_CODE,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					BUDGET_DETAILS_ID,
					APPLIED_RATE,
					BASE_COST_SHARING,
					CALCULATED_COST,
					CALCULATED_COST_SHARING,
					END_DATE,
					ON_OFF_CAMPUS_FLAG,
					RATE_NUMBER,
					START_DATE )
					
                 VALUES(
				 LI_BASE_COST,
				 LI_BUDGET_ID,
				 LI_BUDGET_PERIOD,
				 LI_BUDGET_PERIOD_NUMBER,
				 LI_LINE_ITEM_NUMBER,
				 LS_RATE_CLASS_CODE,
				 LS_RATE_TYPE_CODE,
				 LD_UPDATE_TIMESTAMP,
				 LS_UPDATE_USER,
				 LI_BUDGET_DETAILS_ID,
				 LI_APPLIED_RATE,
				 LI_BASE_COST_SHARING,
				 LI_CALCULATED_COST,
				 LI_CALCULATED_COST_SHARING,
				 LD_END_DATE,
				 LS_ON_OFF_CAMPUS_FLAG,
				 LI_RATE_NUMBER,
				 LD_START_DATE           
                );
                
              
		END LOOP SEL_BUDGET_RATE_AND_BASE;
		CLOSE SEL_BUDGET_RATE_AND_BASE;
		END LOOP SEL_BUDGET_DETAIL;
		CLOSE SEL_BUDGET_DETAIL; 
		
	END LOOP SEL_BUDGET_PERIOD;
	CLOSE SEL_BUDGET_PERIOD; 
    
    		END LOOP SEL_BUDGET_HEADER;
		CLOSE SEL_BUDGET_HEADER; 		
	
  SET LS_PROC_LOC = 'BUDGET_PERSONS';
			
            OPEN SEL_BUDGET_PERSONS;
            SEL_BUDGET_PERSONS:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_PERSONS INTO LI_LS_BUDGET_PERSON_ID,LS_APPOINTMENT_TYPE_CODE,LI_CALCULATION_BASE,LD_EFFECTIVE_DATE,LS_JOB_CODE,LS_NON_EMPLOYEE_FLAG,LS_PERSON_ID,LS_PERSON_NAME,LI_ROLODEX_ID,LD_SALARY_ANNIVERSARY_DATE,LS_TBN_ID,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER,
            LS_PERSON_TYPE;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_PERSONS;
            END IF;
            
               
                INSERT INTO BUDGET_PERSONS	
                (
					APPOINTMENT_TYPE_CODE,
					BUDGET_HEADER_ID,
					CALCULATION_BASE,
					EFFECTIVE_DATE,
					JOB_CODE,
					NON_EMPLOYEE_FLAG,
					PERSON_ID,
					PERSON_NAME,
					ROLODEX_ID,
					SALARY_ANNIVERSARY_DATE,
					TBN_ID,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					PERSON_TYPE )
					
                 VALUES(
				 LS_APPOINTMENT_TYPE_CODE,
				 LI_BUDGET_HEADER_ID,
				 LI_CALCULATION_BASE,
				 LD_EFFECTIVE_DATE,
				 LS_JOB_CODE,
				 LS_NON_EMPLOYEE_FLAG,
				 LS_PERSON_ID,
				 LS_PERSON_NAME,
				 LI_ROLODEX_ID,
				 LD_SALARY_ANNIVERSARY_DATE,
				 LS_TBN_ID,
				 LD_UPDATE_TIMESTAMP,
				 LS_UPDATE_USER,
				 LS_PERSON_TYPE         
                );
              
       SET 	LI_BUDGET_PERSON_ID =  LAST_INSERT_ID();   
       
 
		
 SET LS_PROC_LOC = 'BUDGET_PERSON_DETAIL';
			
            OPEN SEL_BUDGET_PERSON_DETAIL;
            SEL_BUDGET_PERSON_DETAIL:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_PERSON_DETAIL INTO  LS_PERSON_NAME ,LS_PERSON_TYPE ,LS_PERSON_ID ,LI_ROLODEX_ID ,LS_TBN_ID ,LI_UNDERRECOVERY_AMOUNT,
					LI_PERCENT_CHARGED ,LI_PERCENT_EFFORT,LI_COST_SHARING_AMOUNT,LI_COST_SHARING_PERCENT,LI_SALARY_REQUESTED,LI_TOTAL_SALARY,
					LI_NO_OF_MONTHS ,LD_UPDATE_TIMESTAMP ,LS_UPDATE_USER , LD_END_DATE,LD_START_DATE ,LI_SPONSOR_REQUESTED_AMOUNT ,
					LI_SALARY;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_PERSON_DETAIL;
            END IF;
            
                
                INSERT INTO BUDGET_PERSON_DETAIL	
                (
					BUDGET_DETAILS_ID,
					PERSON_NAME,
					PERSON_TYPE,
					PERSON_ID,
					ROLODEX_ID,
					TBN_ID,
					UNDERRECOVERY_AMOUNT,
					PERCENT_CHARGED,
					PERCENT_EFFORT,
					COST_SHARING_AMOUNT,
					COST_SHARING_PERCENT,
					SALARY_REQUESTED,
					TOTAL_SALARY,
					NO_OF_MONTHS,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					BUDGET_PERSON_ID,
					END_DATE,
					START_DATE,
					SPONSOR_REQUESTED_AMOUNT,
					SALARY
					)
					
                 VALUES(
				 LI_BUDGET_DETAILS_ID,
				 LS_PERSON_NAME,
				 LS_PERSON_TYPE,
				 LS_PERSON_ID,
				 LI_ROLODEX_ID,
				 LS_TBN_ID,
				 LI_UNDERRECOVERY_AMOUNT,
				 LI_PERCENT_CHARGED,
				 LI_PERCENT_EFFORT,
				 LI_COST_SHARING_AMOUNT,
				 LI_COST_SHARING_PERCENT,
				 LI_SALARY_REQUESTED,
				 LI_TOTAL_SALARY,
				 LI_NO_OF_MONTHS,
				 LD_UPDATE_TIMESTAMP,
				 LS_UPDATE_USER,
				 LI_BUDGET_PERSON_ID,
				 LD_END_DATE,
				 LD_START_DATE,
				 LI_SPONSOR_REQUESTED_AMOUNT,
				 LI_SALARY       
                );
                
              SET LI_BUDGET_PERSON_DETAIL_ID =  LAST_INSERT_ID();
			  
  
        
 SET LS_PROC_LOC = 'BUDGET_PERSON_DET_CAL_AMT';
			
            OPEN SEL_BUDGET_PERSON_DET_CAL_AMT;
            SEL_BUDGET_PERSON_DET_CAL_AMT:LOOP
			
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_PERSON_DET_CAL_AMT INTO LI_BUDGET_ID,LI_BUDGET_PERIOD,LI_BUDGET_PERIOD_NUMBER,LS_APPLY_RATE_FLAG,LI_CALCULATED_COST,LI_CALCULATED_COST_SHARING,LI_LINE_ITEM_NUMBER,LS_RATE_CLASS_CODE,LS_RATE_TYPE_CODE,LS_RATE_TYPE_DESCRIPTION,LI_APPLICABLE_RATE,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_PERSON_DET_CAL_AMT;
            END IF;
            
               
                INSERT INTO BUDGET_PERSON_DET_CAL_AMT	
                (
					BUDGET_PERSON_DETAIL_ID,
					BUDGET_ID,
					BUDGET_PERIOD,
					BUDGET_PERIOD_NUMBER,
					APPLY_RATE_FLAG,
					CALCULATED_COST,
					CALCULATED_COST_SHARING,
					LINE_ITEM_NUMBER,
					RATE_CLASS_CODE,
					RATE_TYPE_CODE,
					RATE_TYPE_DESCRIPTION,
					APPLICABLE_RATE,
					UPDATE_TIMESTAMP,
					UPDATE_USER
					)
					
                 VALUES(
				LI_BUDGET_PERSON_DETAIL_ID,
				LI_BUDGET_ID,
				LI_BUDGET_PERIOD,
				LI_BUDGET_PERIOD_NUMBER,
				LS_APPLY_RATE_FLAG,
				LI_CALCULATED_COST,
				LI_CALCULATED_COST_SHARING,
				LI_LINE_ITEM_NUMBER,
				LS_RATE_CLASS_CODE,
				LS_RATE_TYPE_CODE,
				LS_RATE_TYPE_DESCRIPTION,
				LI_APPLICABLE_RATE,
				LD_UPDATE_TIMESTAMP,
				LS_UPDATE_USER
                );
                
				
						
		END LOOP SEL_BUDGET_PERSON_DET_CAL_AMT;
		CLOSE SEL_BUDGET_PERSON_DET_CAL_AMT;  
            
		
		
		END LOOP SEL_BUDGET_PERSON_DETAIL;
		CLOSE SEL_BUDGET_PERSON_DETAIL;	
          END LOOP SEL_BUDGET_PERSONS;
		CLOSE SEL_BUDGET_PERSONS;  		
 	
	 SET LS_PROC_LOC = 'BUDGET_MODULAR';
			
            OPEN SEL_BUDGET_MODULAR;
            SEL_BUDGET_MODULAR:LOOP
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_MODULAR INTO LI_CONSORTIUM_FNA,LI_DIRECT_COST_LESS_CONSOR_FNA,LI_TOTAL_DIRECT_COST,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_MODULAR;
            END IF;
            
               
                INSERT INTO BUDGET_MODULAR	
                (
					BUDGET_PERIOD_ID,
					BUDGET_HEADER_ID,
					CONSORTIUM_FNA,
					DIRECT_COST_LESS_CONSOR_FNA,
					TOTAL_DIRECT_COST,
					UPDATE_TIMESTAMP,
					UPDATE_USER
					)
					
                 VALUES(
				LI_BUDGET_PERIOD_ID,
				LI_BUDGET_HEADER_ID,
				LI_CONSORTIUM_FNA,
				LI_DIRECT_COST_LESS_CONSOR_FNA,
				LI_TOTAL_DIRECT_COST,
				LD_UPDATE_TIMESTAMP,
				LS_UPDATE_USER
                );
                
              
		END LOOP SEL_BUDGET_MODULAR;
		CLOSE SEL_BUDGET_MODULAR; 
 
 SET LS_PROC_LOC = 'BUDGET_MODULAR_IDC';
			
            OPEN SEL_BUDGET_MODULAR_IDC;
            SEL_BUDGET_MODULAR_IDC:LOOP
			SET NOT_FOUND = 0;
            FETCH SEL_BUDGET_MODULAR_IDC INTO LI_DESCRIPTION,LI_FUNDS_REQUESTED,LI_IDC_BASE,LI_IDC_RATE,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_BUDGET_MODULAR_IDC;
            END IF;
            
               
                INSERT INTO BUDGET_MODULAR_IDC	
                (
					DESCRIPTION,
					FUNDS_REQUESTED,
					IDC_BASE,
					IDC_RATE,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					BUDGET_PERIOD_ID
					)
					
                 VALUES(				 
				LI_DESCRIPTION,
				LI_FUNDS_REQUESTED,
				LI_IDC_BASE,
				LI_IDC_RATE,
				LD_UPDATE_TIMESTAMP,
				LS_UPDATE_USER,
				LI_BUDGET_PERIOD_ID
                );
                
              
		END LOOP SEL_BUDGET_MODULAR_IDC;
		CLOSE SEL_BUDGET_MODULAR_IDC;  
 
 SET LS_PROC_LOC = 'EPS_PROPOSAL_RATES';
			
            OPEN SEL_EPS_PROPOSAL_RATES;
            SEL_EPS_PROPOSAL_RATES:LOOP
			SET NOT_FOUND = 0;
            FETCH SEL_EPS_PROPOSAL_RATES INTO LS_ACTIVITY_TYPE_CODE,LI_APPLICABLE_RATE,LS_FISCAL_YEAR,LI_INSTITUTE_RATE,LS_ON_OFF_CAMPUS_FLAG,LS_RATE_CLASS_CODE,LS_RATE_TYPE_CODE,LD_START_DATE,LD_UPDATE_TIMESTAMP,LS_UPDATE_USER;
 
			
            IF NOT_FOUND=1 THEN
            LEAVE SEL_EPS_PROPOSAL_RATES;
            END IF;
            
               
                INSERT INTO EPS_PROPOSAL_RATES	
                (
					ACTIVITY_TYPE_CODE,
					APPLICABLE_RATE,
					FISCAL_YEAR,
					INSTITUTE_RATE,
					ON_OFF_CAMPUS_FLAG,
					RATE_CLASS_CODE,
					RATE_TYPE_CODE,
					START_DATE,
					UPDATE_TIMESTAMP,
					UPDATE_USER,
					BUDGET_HEADER_ID
					)
					
                 VALUES(				 
				LS_ACTIVITY_TYPE_CODE,
				LI_APPLICABLE_RATE,
				LS_FISCAL_YEAR,
				LI_INSTITUTE_RATE,
				LS_ON_OFF_CAMPUS_FLAG,
				LS_RATE_CLASS_CODE,
				LS_RATE_TYPE_CODE,
				LD_START_DATE,
				LD_UPDATE_TIMESTAMP,
				LS_UPDATE_USER,
				LI_BUDGET_HEADER_ID
                );
                
              
		END LOOP SEL_EPS_PROPOSAL_RATES;
		CLOSE SEL_EPS_PROPOSAL_RATES;  	
 
 	 		 
 END
