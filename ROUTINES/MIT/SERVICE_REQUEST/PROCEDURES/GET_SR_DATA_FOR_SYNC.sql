CREATE PROCEDURE `GET_SR_DATA_FOR_SYNC`(
    IN AV_START_TIMESTAMP DATETIME,
    IN AV_END_TIMESTAMP DATETIME,
    IN AV_OFFSET INT,
    IN AV_LIMIT INT
)
BEGIN
    SELECT 
        SR.MODULE_CODE,
        SR.SR_HEADER_ID,
        P.FULL_NAME AS REPORTER_NAME,
        SR.SUBJECT,
        SR.STATUS_CODE,
        SS.DESCRIPTION AS STATUS_DESCRIPTION,
        U.UNIT_NAME AS LEAD_UNIT_NAME,
        SR.UNIT_NUMBER AS LEAD_UNIT_NUMBER,
        SR.DESCRIPTION,
        ST.DESCRIPTION AS TYPE_DESCRIPTION,
        SC.DESCRIPTION AS CATEGORY_DESCRIPTION,
        SPRIO.DESCRIPTION AS PRIORITY_DESCRIPTION,
        SR.UPDATE_USER,
        SR.UPDATE_TIMESTAMP,
        SP.FULL_NAME AS PI_NAME,
        SR.TYPE_CODE,
        SR.CATEGORY_CODE,
        SR.PRIORITY_ID,
        AP.FULL_NAME AS AA_PERSON_FULL_NAME
    FROM (
        SELECT * FROM SR_HEADER
        WHERE UPDATE_TIMESTAMP BETWEEN AV_START_TIMESTAMP AND AV_END_TIMESTAMP
        ORDER BY SR_HEADER_ID ASC
        LIMIT AV_LIMIT OFFSET AV_OFFSET
    ) SR
    LEFT JOIN UNIT U ON U.UNIT_NUMBER = SR.UNIT_NUMBER
    LEFT JOIN PERSON P ON P.PERSON_ID = SR.REPORTER_PERSON_ID
    LEFT JOIN SR_STATUS SS ON SS.STATUS_CODE = SR.STATUS_CODE
    LEFT JOIN (
        SELECT SR_HEADER_ID, PERSON_ID, ROLODEX_ID, FULL_NAME
        FROM SR_PERSONS
        WHERE PERSON_ROLE_ID = 3
    ) SP ON SP.SR_HEADER_ID = SR.SR_HEADER_ID
    LEFT JOIN SR_TYPE ST ON ST.TYPE_CODE = SR.TYPE_CODE
    LEFT JOIN SR_CATEGORY SC ON SC.CATEGORY_CODE = SR.CATEGORY_CODE
    LEFT JOIN SR_PRIORITY SPRIO ON SPRIO.PRIORITY_ID = SR.PRIORITY_ID
    LEFT JOIN PERSON AP ON AP.PERSON_ID = SR.ASSIGNEE_PERSON_ID;
END
