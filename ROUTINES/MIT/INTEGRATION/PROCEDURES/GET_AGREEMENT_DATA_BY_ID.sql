CREATE OR REPLACE PROCEDURE GET_AGREEMENT_DATA_BY_ID (
    AV_AGREEMENT_ID IN NUMBER,
    AV_RESULT_SET   OUT SYS_REFCURSOR
) IS
BEGIN
    OPEN AV_RESULT_SET FOR
        SELECT 
            A_G.AGREEMENT_REQUEST_ID,
            A_G.CATEGORY_CODE,
            A_C.DESCRIPTION AS CATEGORY,
            A_G.AGREEMENT_TYPE_CODE,
            A_T.DESCRIPTION AS AGREEMENT_TYPE,
            A_G.AGREEMENT_STATUS_CODE,
            A_S.DESCRIPTION AS AGREEMENT_STATUS,
            A_G.UNIT_NUMBER,
            A_G.UNIT_NAME,
            A_G.TITLE,
            A_G.REQUESTOR_NAME,
            A_G.PI_PERSON_ID,
            A_G.PI_NAME,
            A_G.START_DATE,
            A_G.END_DATE,
            A_G.UPDATE_TIMESTAMP,
            A_G.UPDATE_USER,
            S.SPONSOR_CODE,
            S.SPONSOR_NAME,
            A_G.ADMIN_PERSON_NAME,
            A_G.REQUESTOR_PERSON_ID,
            A_G.ADMIN_PERSON_ID
        FROM AGREEMENT_HEADER A_G
        LEFT JOIN AGREEMENT_CATEGORY A_C
            ON A_G.CATEGORY_CODE = A_C.CATEGORY_CODE
        LEFT JOIN AGREEMENT_TYPE A_T
            ON A_G.AGREEMENT_TYPE_CODE = A_T.AGREEMENT_TYPE_CODE
        LEFT JOIN AGREEMENT_STATUS A_S
            ON A_G.AGREEMENT_STATUS_CODE = A_S.AGREEMENT_STATUS_CODE
        LEFT JOIN (
            SELECT AGREEMENT_REQUEST_ID, SPONSOR_NAME, SPONSOR_CODE
            FROM AGREEMENT_SPONSOR
            WHERE AGREEMENT_SPONSOR_TYPE_CODE = 1
        ) S
        ON A_G.AGREEMENT_REQUEST_ID = S.AGREEMENT_REQUEST_ID
        WHERE A_G.AGREEMENT_REQUEST_ID = AV_AGREEMENT_ID;
END GET_AGREEMENT_DATA_BY_ID;
