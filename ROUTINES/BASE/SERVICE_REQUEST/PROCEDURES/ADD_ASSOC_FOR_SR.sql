-- `ADD_ASSOC_FOR_SR`; 

CREATE PROCEDURE `ADD_ASSOC_FOR_SR`(
AV_SOURCE_MODULE_ID 	 				 INT,
AV_DESTINATION_MODULE_ID 				  INT,
AV_DESTINATION_MODULE_CODE 		 	  INT,
AV_DESTINATION_ASSOC_CONFIG			 VARCHAR (3),
AV_DEPENDENCE_RELATION				  VARCHAR (3),
AV_UPDATED_USER		VARCHAR(60)
)
BEGIN
DECLARE LS_MODULE_ITEM_KEY VARCHAR(12);
IF AV_DESTINATION_MODULE_CODE = 1 THEN
	SELECT AWARD_NUMBER  INTO LS_MODULE_ITEM_KEY
	from AWARD
	where AWARD_ID = AV_DESTINATION_MODULE_ID;
ELSEIF AV_DESTINATION_MODULE_CODE = 2 THEN
	SELECT PROPOSAL_NUMBER  INTO LS_MODULE_ITEM_KEY
	from PROPOSAL
	where PROPOSAL_ID = AV_DESTINATION_MODULE_ID;
ELSE
	SET LS_MODULE_ITEM_KEY = AV_DESTINATION_MODULE_ID;
END IF;
INSERT INTO ASSOC_SR(
		  SR_HEADER_ID
		, RELATION_TYPE_CODE
		, ASSOC_CONFIG_CODE
		, ASSOC_TYPE
		, MODULE_CODE
		, MODULE_ITEM_KEY
		, MODULE_ITEM_ID
		, UPDATE_USER
		, UPDATE_TIMESTAMP
		) VALUES(
		 AV_SOURCE_MODULE_ID
		,AV_DEPENDENCE_RELATION
		,AV_DESTINATION_ASSOC_CONFIG
		,'REVERSE'
		,AV_DESTINATION_MODULE_CODE
		,LS_MODULE_ITEM_KEY
		,AV_DESTINATION_MODULE_ID
		, AV_UPDATED_USER
		,utc_timestamp()
		);
END
