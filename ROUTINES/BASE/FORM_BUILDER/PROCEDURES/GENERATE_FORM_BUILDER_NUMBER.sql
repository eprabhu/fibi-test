-- `GENERATE_FORM_BUILDER_NUMBER`;

CREATE PROCEDURE `GENERATE_FORM_BUILDER_NUMBER`(OUT NEXT_VALUE VARCHAR(20))
BEGIN
    DECLARE LOCK_ACQUIRED INT DEFAULT 0;
    START TRANSACTION;
    SELECT GET_LOCK('LOCK_ON_FORM_BUILDER_NUMBER_COUNTER', 30) INTO LOCK_ACQUIRED;
    IF LOCK_ACQUIRED THEN
        SELECT COUNTER_VALUE INTO NEXT_VALUE FROM FORM_BUILDER_COUNTER WHERE COUNTER_NAME = 'FORM_BUILDER_NUMBER' FOR UPDATE;
		
        UPDATE FORM_BUILDER_COUNTER SET COUNTER_VALUE = COUNTER_VALUE + 1 WHERE COUNTER_NAME = 'FORM_BUILDER_NUMBER';
		 COMMIT;
        SELECT RELEASE_LOCK('LOCK_ON_FORM_BUILDER_NUMBER_COUNTER');
		
    END IF;
   
END
