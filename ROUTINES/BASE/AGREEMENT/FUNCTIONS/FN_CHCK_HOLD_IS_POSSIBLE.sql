-- `FN_CHCK_HOLD_IS_POSSIBLE`; 


CREATE FUNCTION `FN_CHCK_HOLD_IS_POSSIBLE`(
    AV_MODULE_ITEM_KEY INT,
    AV_IS_HOLD VARCHAR(1)
) RETURNS varchar(300) 
    DETERMINISTIC
BEGIN
    DECLARE LS_MESSAGE VARCHAR(300) DEFAULT '';
    DECLARE LS_HOLD VARCHAR(1);
    DECLARE LS_STATUS_CODE VARCHAR(3);
    
    SELECT IS_HOLD, AGREEMENT_STATUS_CODE INTO LS_HOLD, LS_STATUS_CODE 
    FROM AGREEMENT_HEADER 
    WHERE AGREEMENT_REQUEST_ID = AV_MODULE_ITEM_KEY;
    
    IF LS_HOLD = AV_IS_HOLD OR LS_STATUS_CODE IN ('10', '4', '8', '9', '5') THEN 
        SET LS_MESSAGE = 'This action is currently being accessed by another user. Please refresh';
    END IF;
    
    RETURN LS_MESSAGE;
END
