CREATE FUNCTION `FN_COUNT_OF_DMP_UPDATE`(AV_AWARD_NUMBER  VARCHAR(22)
) RETURNS int
    DETERMINISTIC
BEGIN

	DECLARE LI_COUNT INT;
    SELECT COUNT(*) + 1 INTO LI_COUNT
    FROM AWARD T1
    WHERE T1.AWARD_NUMBER = AV_AWARD_NUMBER
      AND EXISTS (
          SELECT 1
          FROM SR_HEADER T8
          WHERE T8.MODULE_CODE = 1
            AND T8.MODULE_ITEM_KEY = (
                SELECT MAX(AWARD_ID)
                FROM AWARD
                WHERE AWARD_ID < T1.AWARD_ID
                AND AWARD_NUMBER = T1.AWARD_NUMBER
            )
            AND T8.TYPE_CODE = 5
      );


RETURN LI_COUNT;

END
