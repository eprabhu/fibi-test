-- `FETCH_AND_UPDATE_AWARD_FOR_SCHEDULER`; 

CREATE PROCEDURE `FETCH_AND_UPDATE_AWARD_FOR_SCHEDULER`()
BEGIN
    DECLARE DONE INT DEFAULT FALSE;
    DECLARE LI_AWARD_ID INT;
    DECLARE LIST_AWARD VARCHAR(2000);
    SET SESSION GROUP_CONCAT_MAX_LEN = 1000000;
    SELECT GROUP_CONCAT(AWARD_ID)  into LIST_AWARD FROM AWARD WHERE STATUS_CODE = '6' AND BEGIN_DATE <= UTC_TIMESTAMP();
 
     UPDATE AWARD T1
        SET T1.STATUS_CODE = '1',
            T1.DOCUMENT_UPDATE_USER = T1.UPDATE_USER ,
            T1.DOCUMENT_UPDATE_TIMESTAMP = UTC_TIMESTAMP()
        WHERE find_in_set (T1.AWARD_ID,LIST_AWARD);
select LIST_AWARD;
    
END
