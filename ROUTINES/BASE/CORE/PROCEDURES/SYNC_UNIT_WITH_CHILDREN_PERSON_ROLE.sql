-- `SYNC_UNIT_WITH_CHILDREN_PERSON_ROLE`; 

CREATE PROCEDURE `SYNC_UNIT_WITH_CHILDREN_PERSON_ROLE`(
	AV_UNIT_NUMBER            VARCHAR(60),
	AV_CHILD_UNIT_NUMBER            VARCHAR(60),
	AV_PARENT_UNIT_CHANGED 		 BOOLEAN
)
BEGIN
	IF (AV_PARENT_UNIT_CHANGED = TRUE) THEN
        DELETE FROM UNIT_WITH_CHILDREN WHERE CHILD_UNIT_NUMBER = AV_CHILD_UNIT_NUMBER;
	END IF;
	INSERT INTO unit_with_children (UNIT_NUMBER, CHILD_UNIT_NUMBER)
		SELECT T1.UNIT_NUMBER, AV_CHILD_UNIT_NUMBER AS CHILD_UNIT_NUMBER 
		FROM unit_with_children T1 WHERE T1.CHILD_UNIT_NUMBER = AV_UNIT_NUMBER;
    INSERT INTO unit_with_children (UNIT_NUMBER, CHILD_UNIT_NUMBER) VALUES(
		AV_CHILD_UNIT_NUMBER, AV_CHILD_UNIT_NUMBER);
END
