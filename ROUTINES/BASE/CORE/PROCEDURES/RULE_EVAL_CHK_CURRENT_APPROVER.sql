-- `RULE_EVAL_CHK_CURRENT_APPROVER`; 

CREATE PROCEDURE `RULE_EVAL_CHK_CURRENT_APPROVER`(
AV_MODULE_ITEM_KEY       VARCHAR(20),
AV_MODULE_CODE           INT(3),
AV_LOGGIN_PERSON_ID      VARCHAR(40),
AV_SUBMODULE_CODE     	 INT,
AV_SUB_MODULE_ITEM_KEY    VARCHAR(20)
)
    DETERMINISTIC
BEGIN
DECLARE LS_APPROVAL_STATUS  VARCHAR(10);
DECLARE LL_COUNT               INT;
SELECT COUNT(*) INTO LL_COUNT
FROM WORKFLOW_DETAIL 
WHERE WORKFLOW_ID = (SELECT WORKFLOW_ID  
					 FROM WORKFLOW 
                     WHERE MODULE_ITEM_ID = AV_MODULE_ITEM_KEY
                     AND MODULE_CODE = AV_MODULE_CODE
					 AND SUB_MODULE_CODE = AV_SUBMODULE_CODE
					 AND SUB_MODULE_ITEM_ID = AV_SUB_MODULE_ITEM_KEY
                     AND IS_WORKFLOW_ACTIVE = 'Y'
                      ) 
      AND APPROVER_PERSON_ID = AV_LOGGIN_PERSON_ID
      AND APPROVAL_STATUS  = 'W';
IF LL_COUNT > 0 THEN 
	SELECT 1;
ELSE 
	SELECT 0;
END IF;
END
