-- `ROLE_RIGHTS_AUDIT_PROC`; 

CREATE PROCEDURE `ROLE_RIGHTS_AUDIT_PROC`(	AV_SOURCE VARCHAR(25),
											AV_MODE VARCHAR(10),  
											AV_OLD_RLE_RIGHTS_ID DECIMAL(22,0),
											AV_NEW_RLE_RIGHTS_ID DECIMAL(22,0),
											AV_OLD_PER_ROLES_ID DECIMAL(22,0),
											AV_NEW_PER_ROLES_ID DECIMAL(22,0),
											AV_OLD_PERSON_ID VARCHAR(40),
											AV_NEW_PERSON_ID VARCHAR(40),
											AV_OLD_ROLE_ID INT,
											AV_NEW_ROLE_ID INT,
											AV_OLD_RIGHT_ID INT,
											AV_NEW_RIGHT_ID INT,
											AV_OLD_UNIT_NUM VARCHAR(50),
											AV_NEW_UNIT_NUM VARCHAR(50),
											AV_OLD_DESCEND_FLG VARCHAR(1),
											AV_NEW_DESCEND_FLG VARCHAR(1),
                                            AV_UPDATE_USER VARCHAR(60)
										)
BEGIN
	INSERT INTO ROLE_RIGHTS_AUDIT_TAB (SOURCE,
							           MODE,
									   OLD_RLE_RIGHTS_ID,
									   NEW_RLE_RIGHTS_ID,
									   OLD_PER_ROLES_ID,
									   NEW_PER_ROLES_ID,
									   OLD_PERSON_ID,
									   NEW_PERSON_ID, 
									   OLD_ROLE_ID,
									   NEW_ROLE_ID,  
									   OLD_ROLE_NAME,
									   NEW_ROLE_NAME,
									   OLD_RIGHT_ID,
									   NEW_RIGHT_ID,   
									   OLD_UNIT_NUMBER,
									   NEW_UNIT_NUMBER,  
									   OLD_DESCEND_FLG,
									   NEW_DESCEND_FLG,									   
									   UPDATE_TIMESTAMP,
									   UPDATE_USER)
							    VALUES(AV_SOURCE,
									   AV_MODE,
									   AV_OLD_RLE_RIGHTS_ID,
									   AV_NEW_RLE_RIGHTS_ID,
									   AV_OLD_PER_ROLES_ID,
									   AV_NEW_PER_ROLES_ID,
									   AV_OLD_PERSON_ID,
									   AV_NEW_PERSON_ID,
									   AV_OLD_ROLE_ID,
									   AV_NEW_ROLE_ID,
                                       (SELECT ROLE_NAME FROM ROLE WHERE ROLE_ID = AV_OLD_ROLE_ID),
									   (SELECT ROLE_NAME FROM ROLE WHERE ROLE_ID = AV_NEW_ROLE_ID),
									   AV_OLD_RIGHT_ID,
									   AV_NEW_RIGHT_ID,
									   AV_OLD_UNIT_NUM,
									   AV_NEW_UNIT_NUM,
									   AV_OLD_DESCEND_FLG,
									   AV_NEW_DESCEND_FLG,									   
									   utc_timestamp(),
									   AV_UPDATE_USER
									   );
END
