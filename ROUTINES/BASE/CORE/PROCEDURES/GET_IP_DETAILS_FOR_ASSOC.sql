CREATE PROCEDURE GET_IP_DETAILS_FOR_ASSOC(
    IN AV_MODULE_ITEM_ID INT
)
BEGIN

SELECT 'ID'
	,'Title'
	,'Status'
	,'Principal Investigator'
	,'Lead Unit'
	,'Proposed Start Date'
	,'Proposed End Date'
	,'Sponsor'
	,'Total Project Cost'
UNION 
		SELECT
			   T1.PROPOSAL_NUMBER,
			   T1.TITLE,
			   T2.DESCRIPTION,
			   t7.FULL_NAME AS PI,
			   T4.DISPLAY_NAME AS LEAD_UNIT,
			   DATE(t1.START_DATE) AS START_DATE,
			   DATE(t1.END_DATE) AS END_DATE,
			   T5.DISPLAY_NAME AS SPONSOR,
			   t6.TOTAL_COST
		 FROM PROPOSAL T1
		 INNER JOIN PROPOSAL_STATUS T2 ON T2.STATUS_CODE = T1.STATUS_CODE
		 LEFT join unit T4 ON T4.UNIT_NUMBER = T1.HOME_UNIT_NUMBER
		 left join SPONSOR t5 on t5.SPONSOR_CODE = t1.SPONSOR_CODE
		 LEFT JOIN ip_budget_header t6 ON t6.PROPOSAL_ID = t1.PROPOSAL_ID
		 LEFT JOIN (SELECT 
					p1.PROPOSAL_ID AS PROPOSAL_ID,
						p1.PERSON_ID AS PERSON_ID,
						p1.ROLODEX_ID AS ROLODEX_ID,
						p1.FULL_NAME AS FULL_NAME
				FROM
					proposal_persons p1
				WHERE
					(p1.PI_FLAG = 'Y')
				GROUP BY p1.PROPOSAL_ID) t7 ON ((t7.PROPOSAL_ID = t1.PROPOSAL_ID))
		WHERE T1.PROPOSAL_ID = AV_MODULE_ITEM_ID;

END
