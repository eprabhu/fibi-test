databaseChangeLog: 

- changeSet:
      id: FC-7386-1
      author: Prabhu.E
      labels: 'DML'
      comment: Update JOIN_QUERY for REPORT_TYPE_JOIN for type_code 48
      changes:
        - sql:
            sql: |
              SET SQL_SAFE_UPDATES =0;
              UPDATE `REPORT_TYPE_JOIN` SET `JOIN_QUERY` = 'INNER JOIN (SELECT DISTINCT AWARD_ID,AWARD_NUMBER,BUDGET_CATEGORY_CODE,SUM(PERIOD_1)AS PERIOD_1,SUM(PERIOD_2)AS PERIOD_2, SUM(PERIOD_3)AS PERIOD_3, SUM(PERIOD_4) AS PERIOD_4,SUM(PERIOD_5) AS PERIOD_5,SUM(PERIOD_6)AS PERIOD_6,SUM(PERIOD_7)AS PERIOD_7,SUM(PERIOD_8) AS PERIOD_8,SUM(PERIOD_9)AS PERIOD_9,SUM(PERIOD_10)AS PERIOD_10,(SUM(PERIOD_1)+SUM(PERIOD_2)+SUM(PERIOD_3)+SUM(PERIOD_4)+SUM(PERIOD_5)+SUM(PERIOD_6)+SUM(PERIOD_7)+SUM(PERIOD_8)+SUM(PERIOD_9)+SUM(PERIOD_10)) AS TOTAL,ACCOUNT_NUMBER,BUDGET_CATEGORY, CASE WHEN SUM(EXPENDITURE_TO_DATE)  IS NOT NULL THEN SUM(EXPENDITURE_TO_DATE) ELSE 0 END AS EXPENDITURE_TO_DATE,CASE WHEN ROUND((sum(EXPENDITURE_TO_DATE)/sum(LATEST_APPROVED_BUDGET))*100,2)  IS NOT NULL THEN ROUND((sum(EXPENDITURE_TO_DATE)/sum(LATEST_APPROVED_BUDGET))*100,2) ELSE 0 END as UTILIZATION_RATE FROM            ( SELECT DISTINCT A1.AWARD_ID, A1.AWARD_NUMBER, A1.ACCOUNT_NUMBER, T3.BUDGET_CATEGORY_CODE,A3.DESCRIPTION         AS BUDGET_CATEGORY,CASE  WHEN T2.BUDGET_PERIOD=\'1\' THEN T3.LINE_ITEM_COST  ELSE 0  END AS PERIOD_1,   CASE   WHEN T2.BUDGET_PERIOD=\'2\' THEN T3.LINE_ITEM_COST  ELSE 0  END AS PERIOD_2,  CASE   WHEN T2.BUDGET_PERIOD=\'3\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_3,   CASE WHEN T2.BUDGET_PERIOD=\'4\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_4,  CASE WHEN T2.BUDGET_PERIOD=\'5\' THEN T3.LINE_ITEM_COST   ELSE 0   END AS PERIOD_5, CASE WHEN T2.BUDGET_PERIOD=\'6\' THEN T3.LINE_ITEM_COST  ELSE 0 END AS PERIOD_6,   CASE    WHEN T2.BUDGET_PERIOD=\'7\' THEN T3.LINE_ITEM_COST    ELSE 0  END AS PERIOD_7,  CASE   WHEN T2.BUDGET_PERIOD=\'8\' THEN T3.LINE_ITEM_COST   ELSE 0    END AS PERIOD_8,     CASE   WHEN T2.BUDGET_PERIOD=\'9\' THEN T3.LINE_ITEM_COST    ELSE 0    END AS PERIOD_9,    CASE   WHEN T2.BUDGET_PERIOD=\'10\' THEN T3.LINE_ITEM_COST   ELSE 0   END                         AS PERIOD_10,  S2.TOTAL_EXPENSE_AMOUNT  AS EXPENDITURE_TO_DATE, T3.LINE_ITEM_COST as LATEST_APPROVED_BUDGET FROM            AWARD A1	 INNER JOIN      AWARD_BUDGET_HEADER T1   ON              A1.AWARD_ID = T1.AWARD_ID       \nINNER JOIN AWARD_BUDGET_PERIOD T2 ON T2.BUDGET_HEADER_ID = T1.BUDGET_HEADER_ID \nINNER JOIN      AWARD_BUDGET_DETAIL T3   ON              T3.BUDGET_HEADER_ID = T1.BUDGET_HEADER_ID  AND T3.BUDGET_PERIOD_ID = T2.BUDGET_PERIOD_ID  \nINNER JOIN      BUDGET_CATEGORY A3  ON              T3.BUDGET_CATEGORY_CODE = A3.BUDGET_CATEGORY_CODE\nLEFT JOIN       AWARD_EXPENSE_DETAILS S2 ON              A1.AWARD_NUMBER = S2.AWARD_NUMBER AND A1.ACCOUNT_NUMBER = S2.ACCOUNT_NUMBER AND  T3.INTERNAL_ORDER_CODE = S2.INTERNAL_ORDER_CODE\nLEFT JOIN  AWARD_EXPENSE_TRANSACTIONS S3 ON              A1.AWARD_NUMBER = S3.AWARD_NUMBER AND A1.ACCOUNT_NUMBER = S3.ACCOUNT_NUMBER\n  WHERE           A1.AWARD_SEQUENCE_STATUS = \'ACTIVE\'  <FILTER_CONDITION> AND             T1.VERSION_NUMBER IN( SELECT MAX(AB1.VERSION_NUMBER)   FROM   AWARD_BUDGET_HEADER AB1   WHERE  AB1.AWARD_ID = T1.AWARD_ID AND (AWARD_BUDGET_STATUS_CODE =\'10\' or AWARD_BUDGET_STATUS_CODE=\'9\' ) )) AS T1 GROUP BY  AWARD_ID,BUDGET_CATEGORY_CODE)CHILD ON MASTER_DATA.AWARD_ID = CHILD.AWARD_ID AND MASTER_DATA.PERSON_ROLE_ID = 3' WHERE (`TYPE_CODE` = '48');
              SET SQL_SAFE_UPDATES =1;

      rollback:
        - sql:
            sql: |
  
- changeSet:
      id: FC-7386-2
      author: Prabhu.E
      labels: 'DML'
      comment: Update JOIN_QUERY for REPORT_TYPE_JOIN for type_code  49
      changes:
        - sql:
            sql: |
              SET SQL_SAFE_UPDATES =0;
              UPDATE `REPORT_TYPE_JOIN` SET `JOIN_QUERY` = 'INNER JOIN(SELECT DISTINCT AWARD_ID, AWARD_NUMBER, BUDGET_CATEGORY_CODE,SUM(PERIOD_1)  AS PERIOD_1,SUM(PERIOD_2)  AS PERIOD_2,\nSUM(PERIOD_3)  AS PERIOD_3, SUM(PERIOD_4)  AS PERIOD_4, SUM(PERIOD_5)  AS PERIOD_5, SUM(PERIOD_6)  AS PERIOD_6, SUM(PERIOD_7)  AS PERIOD_7,SUM(PERIOD_8)  AS PERIOD_8,\nSUM(PERIOD_9)  AS PERIOD_9, SUM(PERIOD_10) AS PERIOD_10,\n(SUM(PERIOD_1)+SUM(PERIOD_2)+SUM(PERIOD_3)+SUM(PERIOD_4)+SUM(PERIOD_5)+SUM(PERIOD_6)+SUM(PERIOD_7)+SUM(PERIOD_8)+SUM(PERIOD_9)+SUM(PERIOD_10)) AS TOTAL,ACCOUNT_NUMBER,\nBUDGET_CATEGORY,IO_CODE, COST_ELEMENT,SUM(QUANTITY) AS QUANTITY, CASE WHEN EXPENDITURE_TO_DATE IS NOT NULL THEN EXPENDITURE_TO_DATE ELSE 0 END AS EXPENDITURE_TO_DATE,CASE WHEN ROUND((EXPENDITURE_TO_DATE/LATEST_APPROVED_BUDGET)*100,2) IS NOT NULL THEN ROUND((EXPENDITURE_TO_DATE/LATEST_APPROVED_BUDGET)*100,2) ELSE 0 END as UTILIZATION_RATE\nFROM            ( SELECT DISTINCT A1.AWARD_ID, A1.AWARD_NUMBER,  A1.ACCOUNT_NUMBER,  T3.BUDGET_CATEGORY_CODE, A3.DESCRIPTION        \nAS BUDGET_CATEGORY, T3.INTERNAL_ORDER_CODE AS IO_CODE, A4.DESCRIPTION         AS COST_ELEMENT,  CASE WHEN T2.BUDGET_PERIOD=\'1\' THEN T3.LINE_ITEM_COST  ELSE 0 END AS PERIOD_1,\nCASE WHEN T2.BUDGET_PERIOD=\'2\' THEN T3.LINE_ITEM_COST  ELSE 0 END AS PERIOD_2, CASE WHEN T2.BUDGET_PERIOD=\'3\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_3, \nCASE WHEN T2.BUDGET_PERIOD=\'4\' THEN T3.LINE_ITEM_COST   ELSE 0 END AS PERIOD_4,   CASE  WHEN T2.BUDGET_PERIOD=\'5\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_5, \nCASE  WHEN T2.BUDGET_PERIOD=\'6\' THEN T3.LINE_ITEM_COST   ELSE 0  END AS PERIOD_6,  CASE   WHEN T2.BUDGET_PERIOD=\'7\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_7,\nCASE WHEN T2.BUDGET_PERIOD=\'8\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_8, CASE WHEN T2.BUDGET_PERIOD=\'9\' THEN T3.LINE_ITEM_COST ELSE 0 END AS PERIOD_9, \nCASE WHEN T2.BUDGET_PERIOD=\'10\' THEN T3.LINE_ITEM_COST ELSE 0  END         AS PERIOD_10, T3.QUANTITY AS QUANTITY , \nS2.TOTAL_EXPENSE_AMOUNT  AS EXPENDITURE_TO_DATE, T3.LINE_ITEM_COST as LATEST_APPROVED_BUDGET\nFROM            AWARD A1 INNER JOIN      AWARD_BUDGET_HEADER T1 ON              A1.AWARD_ID = T1.AWARD_ID \nINNER JOIN AWARD_BUDGET_PERIOD T2 ON T2.BUDGET_HEADER_ID = T1.BUDGET_HEADER_ID \nINNER JOIN      AWARD_BUDGET_DETAIL T3 ON              T3.BUDGET_HEADER_ID = T1.BUDGET_HEADER_ID  AND T3.BUDGET_PERIOD_ID = T2.BUDGET_PERIOD_ID \nINNER JOIN      BUDGET_CATEGORY A3 ON              T3.BUDGET_CATEGORY_CODE = A3.BUDGET_CATEGORY_CODE \nLEFT JOIN       AWARD_EXPENSE_DETAILS S2 ON              A1.AWARD_NUMBER = S2.AWARD_NUMBER AND A1.ACCOUNT_NUMBER = S2.ACCOUNT_NUMBER AND  T3.INTERNAL_ORDER_CODE = S2.INTERNAL_ORDER_CODE\nLEFT JOIN  AWARD_EXPENSE_TRANSACTIONS S3 ON              A1.AWARD_NUMBER = S3.AWARD_NUMBER AND A1.ACCOUNT_NUMBER = S3.ACCOUNT_NUMBER\nINNER JOIN      COST_ELEMENT A4 ON              T3.COST_ELEMENT = A4.COST_ELEMENT\nWHERE           A1.AWARD_SEQUENCE_STATUS = \'ACTIVE\'   <FILTER_CONDITION> AND             T1.VERSION_NUMBER IN(  SELECT MAX(AB1.VERSION_NUMBER) FROM   AWARD_BUDGET_HEADER AB1 WHERE  AB1.AWARD_ID = T1.AWARD_ID AND (AWARD_BUDGET_STATUS_CODE =\'10\' or AWARD_BUDGET_STATUS_CODE=\'9\' ))) AS T1 GROUP BY AWARD_ID,COST_ELEMENT,IO_CODE)CHILD ON MASTER_DATA.AWARD_ID = CHILD.AWARD_ID AND MASTER_DATA.PERSON_ROLE_ID = 3' WHERE (`TYPE_CODE` = '49');
              SET SQL_SAFE_UPDATES =1;

      rollback:
        - sql:
            sql: |
  